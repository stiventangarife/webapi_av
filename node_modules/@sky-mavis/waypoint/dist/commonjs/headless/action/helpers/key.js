'use strict';

var index = require('../../../index-Pma4qYcb.js');
var toBytes = require('../../../toBytes-Dmnw03lt.js');
require('../../../base-BPC6VLRS.js');
require('../../../size-BDN9jZuU.js');

const createDerivedKey = async (password, salt) => {
  const baseKey = await window.crypto.subtle.importKey("raw", password, {
    name: "PBKDF2"
  }, false, ["deriveKey"]);
  const derivedKey = await window.crypto.subtle.deriveKey({
    name: "PBKDF2",
    salt,
    iterations: 4096,
    hash: "SHA-256"
  }, baseKey, {
    name: "AES-GCM",
    length: 256
  }, true, ["encrypt", "decrypt"]);
  return derivedKey;
};
const DEFAULT_ISS = "https://athena.skymavis.com/";
const deriveKey = async (waypointToken, recoveryPassword) => {
  const {
    sub
  } = index.jwtDecode(waypointToken);
  const salt = toBytes.stringToBytes(`${DEFAULT_ISS}:${sub}`);
  const password = toBytes.stringToBytes(`${DEFAULT_ISS}:${sub}:${recoveryPassword}`);
  return await createDerivedKey(password, salt);
};

exports.deriveKey = deriveKey;

'use strict';

var headless_error_client = require('../../error/client.js');
var headless_wasm_create = require('../../wasm/create.js');
require('../../wasm/instantiate.js');

const wasmGetKeygenHandler = async wasmUrl => {
  const instance = await headless_wasm_create.createWasmInstance(wasmUrl);
  try {
    const keygenHandler = await instance.keygen();
    if (keygenHandler) {
      return keygenHandler;
    }
  } catch (_) {
    /* empty */
  }
  throw new headless_error_client.HeadlessClientError({
    cause: undefined,
    code: headless_error_client.HeadlessClientErrorCode.HandlerNotFoundError,
    message: `Unable to get the keygen handler. This could be due to a wrong version of WASM with url="${wasmUrl}"`
  });
};

exports.wasmGetKeygenHandler = wasmGetKeygenHandler;

'use strict';

var headless_error_client = require('../error/client.js');
var headless_wasm_instantiate = require('./instantiate.js');

let currentInstance;
let currentUrl;
const createWasmInstance = async url => {
  const cached = currentInstance !== undefined;
  const sameUrl = currentUrl === url;
  if (cached && sameUrl) {
    return currentInstance;
  }
  await headless_wasm_instantiate.injectSkymavisMpc(url);
  if (globalThis.skymavismpc) {
    currentInstance = globalThis.skymavismpc;
    currentUrl = url;
    return currentInstance;
  }
  throw new headless_error_client.HeadlessClientError({
    code: headless_error_client.HeadlessClientErrorCode.CreateWasmInstanceError,
    message: `Unable to create WASM instance. The variable "globalThis.skymavismpc" is undefined.`,
    cause: undefined
  });
};

exports.createWasmInstance = createWasmInstance;
